# РТК: Высшая лига
С 14 по 19 сентября в рамках TNF 2024 в Тюмени прошли соревнования по робототехнике РТК: Высшая лига. Наша команда ITMOtion заняла [первое место](https://t.me/cuprtc/695), набрав при этом максимальный балл. Наша команда состоит из студентов 3 и 4 курсов СУиР:
 - Заграничнов Глеб
 - Блохин Сергей
 - Чемякин Андрей
 - Магазенков Егор

Ниже немного подробностей с картиночками и видосами про нашего робота.

# Общее описание задачи
В рамках данных соревнований нужно было разработать автономного робота для обследования нефтянных скажин на местораждении нефти. Необходимо было обнаруживать протечки на устьевых арматурах, а также определять показатели манометров.
Для усложнения маршрута были добавлены ложные съезды, за заезд на которые снимались баллы. Также на трассе могло появиться препятствие в виде коровы, которую нельзя было сбивать.

<center><img src="https://lh3.googleusercontent.com/pw/AP1GczNGaVGpyLnMi2SDE1IewDhRab0d54bqq_WK-dQpq27nWP7pYxDBXvPsytBZn21jy18QBaEDACWCx7nzNGvkHpT5L_4yeOmKqRcnSa7tl0ToD0at0h3Jy8MI3OLw3cRY8Fd9FUoT-nnyjt5VE_YlMEhEQA=w717-h955-s-no-gm?authuser=0" alt="Полигон" width="400"/></center>


# Наш красавец

<center><img src="https://lh3.googleusercontent.com/pw/AP1GczMhXB9lKFcdsyyLY9bKSYBcHnbKP3CKeL52D1zEsbfc_ZwtCgGubtZS2RMmEfpjEV9EbW0b9n6MbfThNQKXRF9xKNwghevw1s2vyDnE-RilQUqwGAX2wLgZNBKvXpgDpnTNNgVPfSJP-Jl13aV9tcSQZw=w1271-h954-s-no-gm" alt="Робот" width="600"></center>

Комплектующие у него следующие:

 - **Raspberry Pi 4 Model B**. Главный узел нашего робота, все управление осуществлялось через него;
 - **Jetson Nano Origin**. На нем крутились наши YOLO;
 - **Arduino Mega 2560**. Переходиник между двигателями и rpi, чтобы не спалить ее случайно;
 - **Intel Realsense**. Хорошая камера с удобным API для Python, использовалась для детекции;
 - **Pi Camera 2**. Направлена на линию, едем по ней;
 - **УЗ HC-SR04**. Им детектили корову;
 - **Коврик для ванны**. Как показали тесты, именно этот материал лучше всего подходил для деревянной поверхности;
 - **Штатив для камеры**. Пришлось клеить уже на полигоне;
 - **Корпус**. Вся конструкция проектировалась и печаталась нами самостоятельно.

# Мозги
Arduino и rpi общались между собой по UART портам, то есть прямым подлючением. Для связи между rpi и jetson был поднять TCP сервер, который по локальной сети подлючал их между собой.

Rpi получала картинку с камеры, установленной на линии, после чего накладывался ч/б фильтр и threshold. Именно так мы детектили линию, после чего вычисляли ее центр масс и находили отклонение от центра. Эта ошибка передается в PID регулятор, рассчитывающий управляющие сигналы для двигателей.

Когда rpi обноруживала поворот налево, что означает, что там находится нефтянная вышка, она просила jetson делать фотку и запускать детекцию с классификацией. Для решения этих задач, после сравнения с чистыми CV решениями, была выбрана YOLOv8, причем две модели -- одна для детекции манометров / протечек, другая для классификации.
Для обучения обеих моделей был собран собственный датасет.

<center><img src="https://lh3.googleusercontent.com/pw/AP1GczPlXLgXgjCzBjwrTm8J58MyIXYLg-GMQxTlaJVKHPQLiqnyhO0Rypt4BPICgqzQtiaQ6q-P979YG7Pii787N96QLQhjlqi4UbKL2GJr2-BYm5fHvRR3gjdLfUnQDGVnYo-IcbTGjrHxph-Ajs7RE5lxuw=w1272-h955-s-no-gm?authuser=0" alt="Детекция" width="600"></center>
